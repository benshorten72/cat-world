<!DOCTYPE html>
<html>
<head>
  <style> body { margin: 0; } </style>
  <script src="//cdn.jsdelivr.net/npm/globe.gl"></script>
</head>

<body>
  <div id="globeViz"></div>
  <script>
    const markerSvg = `
      <div style="
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      ">
        <img src="loading.png" class="cat-img" style="width: 100%; height: 100%; object-fit: cover;" />
        <img src="playButton.png" class="meow-btn"
          style="
            bottom: 10px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
          " />
         <div class="progress-container" style="width: 100%; height: 5px; background: #ddd; margin-top: 4px;">
        <div class="progress-bar" style="height: 100%; width: 0%; background: #f29900;"></div>
      </div>
    `;
    const originalSrc = 'playButton.png';
    const playingSrc = 'pauseButton.png';
    const N = 1;
    const gData = [...Array(N).keys()].map(() => ({
      lat: 53.2734,
      lng: -7.77832031,
      name: "",
      img_file: "cats/cat1.png",
      snd_file: "cats/cat1.mp3"
    }));

    new Globe(document.getElementById('globeViz'))
      .globeImageUrl('map.png')
      .htmlElementsData(gData)
      .htmlElement(d => {
        const el = document.createElement('div');
        const meowSoundAudio = new Audio(d.snd_file); // Make sure file exists
        const catImage = d.img_file;
        el.innerHTML = markerSvg;
        el.style.width = '100px';
        el.style.height = '150px';
        el.style.overflow = 'hidden';
        el.style.transition = 'opacity 250ms';
        el.style.backgroundColor = 'white';
        el.style.pointerEvents = 'auto';
        el.style.cursor = 'pointer';
        el.style.borderRadius = '8px';
        el.style.boxShadow = '0 0 5px rgba(0,0,0,0.2)';
        el.style.transform = 'translate(-50%, -50%)';

        el.onclick = () => {
          if (el.style.opacity === '1') {
            console.info(d);
          }
        };
        const cat_img = el.querySelector('.cat-img');
        if (cat_img){
          cat_img.src=`${catImage}`;
        }
        const btn = el.querySelector('.meow-btn');
        if (btn) {
            
            btn.onclick = (e) => {
                e.stopPropagation(); // Prevent triggering outer click
                meowSoundAudio.currentTime = 0;
                meowSoundAudio.play();
                btn.src = playingSrc;
            };

            meowSoundAudio.addEventListener('ended', () => {
                btn.src = originalSrc;
            });
            const progressBar = el.querySelector('.progress-bar');

            meowSoundAudio.addEventListener('timeupdate', () => {
            if (progressBar) {
                const percent = (meowSoundAudio.currentTime / meowSoundAudio.duration) * 100;
                progressBar.style.width = `${percent}%`;
            }
            });

            meowSoundAudio.addEventListener('ended', () => {
            btn.src = originalSrc;
            if (progressBar) progressBar.style.width = '0%';
            });
        }

        return el;
      })
      
      .htmlElementVisibilityModifier((el, isVisible) => {
        el.style.opacity = isVisible ? '1' : '0';
        el.style.pointerEvents = isVisible ? 'auto' : 'none';
      });
  </script>
</body>
</html>
